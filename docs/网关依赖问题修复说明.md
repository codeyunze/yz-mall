# 网关依赖问题修复说明

## 问题描述

mall-gateway 模块中所有引用的第三方包都报红，提示 "Cannot resolve symbol 'XXX'"。

## 问题原因

1. **缺少版本号**：`sa-token-reactor-spring-boot-starter` 和 `sa-token-redis-jackson` 两个依赖在 gateway 的 pom.xml 中缺少版本号
2. **父 pom 未定义**：`sa-token-reactor-spring-boot-starter` 在父 pom.xml 的 dependencyManagement 中被注释掉了，导致子模块无法继承版本号

## 修复内容

### 1. 修复 gateway 的 pom.xml

在 `mall-gateway/pom.xml` 中为两个 Sa-Token 依赖添加了版本号：

```xml
<!-- Sa-Token 权限认证（Reactor响应式集成），用于网关响应式环境 -->
<dependency>
    <groupId>cn.dev33</groupId>
    <artifactId>sa-token-reactor-spring-boot-starter</artifactId>
    <version>${sa-token.version}</version>  <!-- 添加版本号 -->
</dependency>

<!-- Sa-Token Redis 集成 -->
<dependency>
    <groupId>cn.dev33</groupId>
    <artifactId>sa-token-redis-jackson</artifactId>
    <version>${sa-token.version}</version>  <!-- 添加版本号 -->
</dependency>
```

### 2. 修复父 pom.xml

在根目录的 `pom.xml` 中取消注释了 `sa-token-reactor-spring-boot-starter`，使其在 dependencyManagement 中定义：

```xml
<!-- Sa-Token 权限认证（Reactor响应式集成），在线文档：https://sa-token.cc -->
<dependency>
    <groupId>cn.dev33</groupId>
    <artifactId>sa-token-reactor-spring-boot-starter</artifactId>
    <version>${sa-token.version}</version>
</dependency>
```

## 解决步骤

如果 IDE 中仍然显示红色，请按以下步骤操作：

### 方式1：刷新 Maven 项目（推荐）

**IntelliJ IDEA：**
1. 右键点击项目根目录
2. 选择 `Maven` -> `Reload Project`
3. 或者点击右侧 Maven 工具栏的刷新按钮

**Eclipse：**
1. 右键点击项目
2. 选择 `Maven` -> `Update Project...`
3. 勾选 `Force Update of Snapshots/Releases`
4. 点击 `OK`

### 方式2：重新导入项目

1. 关闭 IDE
2. 删除项目中的 `.idea` 文件夹（IntelliJ IDEA）或 `.settings` 文件夹（Eclipse）
3. 重新打开项目并导入

### 方式3：命令行刷新依赖

```bash
# 进入项目根目录
cd /path/to/yz-mall

# 清理并重新下载依赖
mvn clean install -DskipTests

# 或者只更新 gateway 模块
mvn dependency:resolve -pl mall-gateway
```

## 验证修复

修复后，以下依赖应该能够正常解析：

- ✅ `cn.dev33:sa-token-reactor-spring-boot-starter:1.43.0`
- ✅ `cn.dev33:sa-token-redis-jackson:1.43.0`
- ✅ `com.yz:mall-redis:0.0.6-SNAPSHOT`
- ✅ `com.yz:mall-auth-interface:0.0.6-SNAKEHOT`
- ✅ `com.yz:mall-json:0.0.6-SNAPSHOT`
- ✅ Spring Cloud Gateway 相关依赖
- ✅ Spring Boot 相关依赖

## 常见问题

### Q1: 刷新后仍然报红？

**A:** 检查以下几点：
1. 确认 Maven 仓库配置正确
2. 检查网络连接，确保能访问 Maven 中央仓库
3. 尝试删除本地 Maven 仓库中的相关依赖，重新下载：
   ```bash
   rm -rf ~/.m2/repository/cn/dev33/sa-token-reactor-spring-boot-starter
   rm -rf ~/.m2/repository/cn/dev33/sa-token-redis-jackson
   ```

### Q2: 编译错误但 IDE 不报红？

**A:** 可能是 IDE 缓存问题，尝试：
1. 清理 IDE 缓存
2. 重启 IDE
3. 重新构建项目

### Q3: 其他模块是否受影响？

**A:** 不会。本次修复只涉及：
- `mall-gateway/pom.xml` - 添加版本号
- `pom.xml` - 取消注释依赖定义

其他模块的依赖配置未改变。

## 依赖关系说明

gateway 模块的依赖传递链：

```
mall-gateway
  ├── sa-token-reactor-spring-boot-starter (直接依赖)
  ├── sa-token-redis-jackson (直接依赖)
  ├── mall-redis (传递依赖: spring-boot-starter-data-redis, redisson)
  ├── mall-auth-interface (传递依赖: sa-token-spring-boot3-starter, mall-base, mall-redis)
  └── mall-json (传递依赖: jackson)
```

所有依赖的版本号都通过父 pom 的 dependencyManagement 统一管理。

